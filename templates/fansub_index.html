{% extends "base.html" %}

{% block title %}Ana Sayfa - Humat Fansub{% endblock %}

{% block content %}

<!-- Hero Section -->
{% if hero_animes %}
<div id="heroCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel">
    <div class="carousel-indicators">
        {% for anime in hero_animes %}
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="{{ loop.index0 }}"
            class="{{ 'active' if loop.first }}" aria-current="true" aria-label="Slide {{ loop.index }}"></button>
        {% endfor %}
    </div>
    <div class="carousel-inner">
        {% for anime in hero_animes %}
        <div class="carousel-item {{ 'active' if loop.first }}">
            <div class="hero-background" style="background-image: url({{ anime.cover_image }});"></div>
            <div class="hero-overlay"></div>
            <div class="hero-content container">
                <h1 class="display-4 fw-bold">{{ anime.name }}</h1>
                <p class="lead col-lg-6">{{ anime.description|truncate(150) }}</p>
                <a href="{{ url_for('anime', anime_id=anime.id) }}" class="btn btn-primary btn-lg">Şimdi İzle</a>
            </div>
        </div>
        {% endfor %}
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>
{% endif %}

<div class="container-fluid content-container mt-5">

    <!-- Anime Rafları -->
    {% if editor_picks %}
    <section class="anime-shelf shelf-editors-pick my-5">
        <h3 class="shelf-title">Editörün Seçimi</h3>
        <div class="shelf-scroll">
            {% for anime in editor_picks %}
            <div class="anime-card">
                <a href="{{ url_for('anime', anime_id=anime.id) }}">
                    <img src="{{ anime.cover_image }}" alt="{{ anime.name }}">
                    <div class="card-overlay">
                        <div class="card-scores">
                            <div class="score-badge"><i class="fas fa-star"></i>{{ "%.2f"|format(anime.average_rating) if anime.average_rating else 'N/A' }}</div>
                            {% if anime.mal_score %}<div class="score-badge mal-score">MAL: {{ anime.mal_score }}</div>{% endif %}
                        </div>
                        <div class="card-bottom">
                            <div class="card-title">{{ anime.name }}</div>
                            <div class="card-play-icon"><i class="fas fa-play-circle"></i></div>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {% if latest_animes %}
    <section class="anime-shelf shelf-latest my-5">
        <h3 class="shelf-title">Son Eklenenler</h3>
        <div class="shelf-scroll">
            {% for anime in latest_animes %}
            <div class="anime-card">
                <a href="{{ url_for('anime', anime_id=anime.id) }}">
                    <img src="{{ anime.cover_image }}" alt="{{ anime.name }}">
                    <div class="card-overlay">
                        <div class="card-scores">
                            <div class="score-badge"><i class="fas fa-star"></i>{{ "%.2f"|format(anime.average_rating) if anime.average_rating else 'N/A' }}</div>
                            {% if anime.mal_score %}<div class="score-badge mal-score">MAL: {{ anime.mal_score }}</div>{% endif %}
                        </div>
                        <div class="card-bottom">
                            <div class="card-title">{{ anime.name }}</div>
                            <div class="card-play-icon"><i class="fas fa-play-circle"></i></div>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {% if personalized_recs %}
    <section class="anime-shelf shelf-personalized my-5">
        <h3 class="shelf-title">Sana Özel Öneriler</h3>
        <div class="shelf-scroll">
            {% for anime in personalized_recs %}
            <div class="anime-card">
                <a href="{{ url_for('anime', anime_id=anime.id) }}">
                    <img src="{{ anime.cover_image }}" alt="{{ anime.name }}">
                    <div class="card-overlay">
                        <div class="card-scores">
                            <div class="score-badge"><i class="fas fa-star"></i>{{ "%.2f"|format(anime.average_rating) if anime.average_rating else 'N/A' }}</div>
                            {% if anime.mal_score %}<div class="score-badge mal-score">MAL: {{ anime.mal_score }}</div>{% endif %}
                        </div>
                        <div class="card-bottom">
                            <div class="card-title">{{ anime.name }}</div>
                            <div class="card-play-icon"><i class="fas fa-play-circle"></i></div>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {% if random_animes %}
    <section class="anime-shelf my-5">
        <h3 class="shelf-title">Rastgele Keşfet</h3>
        <div class="shelf-scroll">
            {% for anime in random_animes %}
            <div class="anime-card">
                <a href="{{ url_for('anime', anime_id=anime.id) }}">
                    <img src="{{ anime.cover_image }}" alt="{{ anime.name }}">
                    <div class="card-overlay">
                        <div class="card-scores">
                            <div class="score-badge"><i class="fas fa-star"></i>{{ "%.2f"|format(anime.average_rating) if anime.average_rating else 'N/A' }}</div>
                            {% if anime.mal_score %}<div class="score-badge mal-score">MAL: {{ anime.mal_score }}</div>{% endif %}
                        </div>
                        <div class="card-bottom">
                            <div class="card-title">{{ anime.name }}</div>
                            <div class="card-play-icon"><i class="fas fa-play-circle"></i></div>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const shelves = document.querySelectorAll('.anime-shelf');

        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });

        shelves.forEach(shelf => {
            observer.observe(shelf);
        });
    });
</script>
{% endblock %}
