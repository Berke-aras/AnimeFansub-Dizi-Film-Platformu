{% extends "base.html" %}

{% block title %}Topluluk Bilgilerini Yönet{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/forum_revamp.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/ckeditor_content.css') }}">
<style>
    /* Force CKEditor text color for admin page */
    .ck.ck-editor__editable {
        color: #f5f5f5 !important;
        background-color: #1c1c1c !important;
    }

    .ck.ck-editor__editable * {
        color: #f5f5f5 !important;
    }

    .ck.ck-editor__editable p {
        color: #f5f5f5 !important;
    }

    .ck.ck-editor__editable span {
        color: #f5f5f5 !important;
    }

    .ck.ck-editor__editable div {
        color: #f5f5f5 !important;
    }

    .ck-content {
        color: #f5f5f5 !important;
    }

    .ck-content * {
        color: #f5f5f5 !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>Topluluk Bilgilerini Yönet</h2>
    <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <div class="mb-3">
            <label for="title" class="form-label">Başlık</label>
            <input type="text" class="form-control" id="title" name="title" value="{{ info.title if info else '' }}">
        </div>
        <div class="mb-3">
            <label for="content" class="form-label">İçerik</label>
            <textarea id="content" name="content">{{ info.content if info else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="image_url" class="form-label">Arka Plan Resim URL'si</label>
            <input type="text" class="form-control" id="image_url" name="image_url"
                value="{{ info.image_url if info else '' }}">
        </div>
        <button type="submit" class="btn btn-primary">Kaydet</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="https://cdn.ckeditor.com/ckeditor5/35.4.0/classic/ckeditor.js"></script>
<script>
    ClassicEditor
        .create(document.querySelector('#content'), {
            htmlSupport: {
                allowOrphanedDom: true,
                allow: [
                    { name: /.*/, attributes: true, classes: true, styles: true }
                ]
            },
            extraAllowedContent: '*',
            contentsCss: ['{{ url_for("static", filename="css/ckeditor_content.css") }}'],
            toolbar: {
                items: [
                    'heading', '|',
                    'bold', 'italic', 'link', '|',
                    'bulletedList', 'numberedList', '|',
                    'outdent', 'indent', '|',
                    'blockQuote', 'insertTable', '|',
                    'undo', 'redo'
                ]
            }
        })
        .then(editor => {
            // Force text color in editor immediately
            const editableElement = editor.ui.getEditableElement();
            if (editableElement) {
                editableElement.style.color = '#f5f5f5 !important';
                editableElement.style.setProperty('color', '#f5f5f5', 'important');
            }

            // Force text color on any change
            editor.editing.view.document.on('change:data', () => {
                const editableElement = editor.ui.getEditableElement();
                if (editableElement) {
                    editableElement.style.color = '#f5f5f5 !important';
                    editableElement.style.setProperty('color', '#f5f5f5', 'important');
                }
            });

            // Force text color after editor is ready
            editor.editing.view.document.on('ready', () => {
                const editableElement = editor.ui.getEditableElement();
                if (editableElement) {
                    editableElement.style.color = '#f5f5f5 !important';
                    editableElement.style.setProperty('color', '#f5f5f5', 'important');
                }
            });
        })
        .catch(error => {
            console.error(error);
        });
</script>
{% endblock %}